<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>STOCKS</title>
  <meta content="" name="description">
  <meta content="" name="keywords">

  <!-- Favicons -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Raleway:300,300i,400,400i,500,500i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
    rel="stylesheet">

  <!-- Vendor CSS Files -->
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Template Main CSS File -->
  <link href="assets/css/style.css" rel="stylesheet">

  <!-- =======================================================
  * Template Name: iPortfolio - v3.1.0
  * Template URL: https://bootstrapmade.com/iportfolio-bootstrap-portfolio-websites-template/
  * Author: BootstrapMade.com
  * License: https://bootstrapmade.com/license/
  ======================================================== -->
</head>

<body>

  <!-- ======= Mobile nav toggle button ======= -->
  <i class="bi bi-list mobile-nav-toggle d-xl-none"></i>

  <!-- ======= Header ======= -->
  <header id="header">
    <div class="d-flex flex-column">

      <div class="profile">
        <img src="assets/img/profile-img.png" alt="" class="img-fluid rounded-circle">
        <h1 class="text-light"><a href="index.html">Christopher Hardin</a></h1>
        <div class="social-links mt-3 text-center">
          <a href="https://twitter.com/Chris09Hardin" class="twitter"><i class="bx bxl-twitter"></i></a>
          <a href="https://www.facebook.com/chris09hardin" class="facebook"><i class="bx bxl-facebook"></i></a>
          <a href="https://www.instagram.com/_chrishardin_/" class="instagram"><i class="bx bxl-instagram"></i></a>
          <a href="https://github.com/chrishardin" class="github"><i class="bx bxl-github"></i></a>
          <a href="https://www.linkedin.com/in/chrishardin-/" class="linkedin"><i class="bx bxl-linkedin"></i></a>
        </div>
      </div>

      <nav id="navbar" class="nav-menu navbar">
        <ul>
          <li><a href="index.html#hero" class="nav-link scrollto active"><i class="bx bx-home"></i>
              <span>Home</span></a></li>
          <li><a href="index.html#about" class="nav-link scrollto"><i class="bx bx-user"></i> <span>About</span></a>
          </li>
          <li><a href="index.html#resume" class="nav-link scrollto"><i class="bx bx-file-blank"></i>
              <span>Resume</span></a></li>
          <li><a href="index.html#portfolio" class="nav-link scrollto"><i class="bx bx-book-content"></i>
              <span>Portfolio</span></a></li>
          <li><a href="index.html#contact" class="nav-link scrollto"><i class="bx bx-envelope"></i>
              <span>Contact</span></a></li>
          <li><a href="stocks.html" class="nav-link scrollto"><i class="bx bx-dollar"></i> <span>STOCKS</span></a>
          </li>
        </ul>
      </nav><!-- .nav-menu -->
    </div>
  </header><!-- End Header -->

  <main id="main">

    <!-- ======= Breadcrumbs ======= -->
    <section class="breadcrumbs">
      <div class="container">

        <div class="d-flex justify-content-between align-items-center">
          <h2>Stocks</h2>
          <ol>
            <li><a href="index.html">Home</a></li>
            <li>Stocks</li>
          </ol>
        </div>

      </div>
    </section><!-- End Breadcrumbs -->

    <!-- ======= Tabs ======= -->
    <div class="container">
      <ul class="nav nav-tabs">
        <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#provided-input-files">Provided input files</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#local-input-files">Local input file</a></li>
        <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#compare-2-local-files">Compare 2 local files</a></li>
      </ul>
    </div><!-- End Tabs -->

    <div class="tab-content">
      <!-- ======= Provided input files ======= -->
      <div id="provided-input-files" class="tab-pane container active"><br>
 
          <script src="./assets/inputStocks.txt"></script>
          <div class="container">
            <h2>Welcome!</h2>

            <!-- Pick provided input file-->
            <label>Choose an list of stocks from the provided dropdown, or provide your own:</label>
            <form id="PI-inputStocksForm">
              <select class="form-select" name="inputStocks" style="width:auto">
                <option selected>Over 8000 US Stocks</option>
                <option value="2" disabled>Null</option>
                <option value="3" disabled>Null</option>
              </select>
              <br>

              <!-- Pick zacks rank -->
              <h4>Pick which Zack Ranks you want to output:</h4>
              <div class="d-flex flex-row">
                <div class="d-flex flex-column flex-fill inline-field">
                  <label class="form-check-label">
                  <input class="form-check-input PI-ranks" type="checkbox" name="StrongBuy" value="1" checked>
                  Strong Buy - 1</label>
                  <label class="form-check-label">
                  <input class="form-check-input PI-ranks" type="checkbox" name="Buy" value="2">
                  Buy - 2</label>
                  <label class="form-check-label">
                  <input class="form-check-input PI-ranks" type="checkbox" name="Hold" value="3">
                  Hold - 3</label>
                  <label class="form-check-label">
                  <input class="form-check-input PI-ranks" type="checkbox" name="Sell" value="4">
                  Sell - 4</label>
                  <label class="form-check-label">
                  <input class="form-check-input PI-ranks" type="checkbox" name="StrongSell" value="5">
                  Strong Sell - 5</label>
                </div>
              </div>
              <br>

              <!-- Fields for headers -->
              <h4>Pick the fields for your output:</h4>
              <div class="d-flex flex-row">
                <!-- About check boxes-->
                <div class="d-flex flex-column flex-fill inline-field">
                  <h5>About Fields</h5>
                  <label class="form-check-label">
                  <input class="PI-outputFields" name="Symbol" type="hidden" value="Symbol" checked>
                  <input class="form-check-input" type="checkbox" name="Symbol" value="Symbol" disabled checked>
                  Symbol</label>
                  <label class="form-check-label">
                  <input class="form-check-input PI-outputFields" type="checkbox" name="Name" value="Name" checked>
                  Name</label>
                  <label class="form-check-label">
                  <input class="form-check-input PI-outputFields" type="checkbox" name="IndustryMajor" value="Industry Major" checked>
                  Industry Major</label>
                  <label class="form-check-label">
                  <input class="form-check-input PI-outputFields" type="checkbox" name="IndustryMinor" value="Industry Minor" checked>
                  Industry Minor</label>
                </div>

                <!-- Ranks check boxes-->
                <div class="d-flex flex-column flex-fill inline-field">
                  <h5>Rank Fields</h5>
                  <label class="form-check-label">
                  <input class="form-check-input PI-outputFields" type="checkbox" name="ZacksRank" value="ZacksRank"checked>
                  Zacks Rank</label>
                  <label class="form-check-label">
                  <input class="form-check-input PI-outputFields" type="checkbox" name="OverallRank" value="OverallRank"checked>
                 Overall Rank</label>
                  <label class="form-check-label">
                  <input class="form-check-input PI-outputFields" type="checkbox" name="Value" value="Value" checked>
                  Value</label>
                  <label class="form-check-label">
                  <input class="form-check-input PI-outputFields" type="checkbox" name="Growth" value="Growth" checked>
                  Growth</label>
                  <label class="form-check-label">
                  <input class="form-check-input PI-outputFields" type="checkbox" name="Momentum" value="Momentum" checked>
                  Momentum</label>
                  <label class="form-check-label">
                  <input class="form-check-input PI-outputFields" type="checkbox" name="VGM" value="VGM" checked>
                  VGM</label>
                </div>

                <!-- Income check boxes-->
                <div class="d-flex flex-column flex-fill inline-field">
                  <h5>Net Income Fields</h5>
                  <label class="form-check-label">
                    <input class="form-check-input PI-outputFields2" type="checkbox" name="Last4Years" value="Last4Years"checked>
                    Over Last 4 Years</label>
                    <label class="form-check-label">
                    <input class="form-check-input PI-outputFields2" type="checkbox" name="Last3Years" value="Last3Years" disabled>
                    Over Last 3 Years</label>
                    <label class="form-check-label">
                    <input class="form-check-input PI-outputFields2" type="checkbox" name="Last2Years" value="Last2Years" disabled>
                    Over Last 2 Years</label>
                    <label class="form-check-label">
                    <input class="form-check-input PI-outputFields2" type="checkbox" name="ConsNetIncGrowth" value="Consecutive Net Income Growth" checked>
                    Consecutive Net Income Growth</label>
                    <label class="form-check-label">
                    <input class="form-check-input PI-outputFields2" type="checkbox" name="AverageGrowth" value="Average Growth" checked>
                    Average Growth</label>
                </div>

              </div>
              <br>

              <!-- Submit button -->
               <!-- id="providedInputStocksSubmit -->
              <button class="btn btn-info" id="submitbutton">Submit</button> 
              <br>
              <div id="loadingMessage" style="display: none;">Loading...</div>
              <div id="progressContainer" style="display: none;">
                <div id="progressText">Progress: 0/0</div>
              </div>
              <div id="resultMessage" style="display: none;"></div>
                <a id="downloadLink" style="display: none;" href="#" download="">Download Output</a>
              <br>
              <br>
              <div id="previousRuns">
                <h3>Previous Runs</h3>
                <ul id="previousRunsList"></ul>
              </div>
              
              <script>
                document.getElementById('submitbutton').addEventListener('click', function(event) {
                    event.preventDefault();
                    const submitButton = document.getElementById('submitbutton');
                    submitButton.disabled = true;

                    const inputFile = 'inputStocks.txt';
                    const outputFile = 'stocksOutput_' + getDateString() + '.csv';
                    const headers = 'Symbol,Name,Industry Major,Industry Minor,Rank,Value,Growth,Momentum,VGM,';
                    const headers2 = 'Net Income 1,Net Income 2,Net Income 3,Net Income 4,Net Income 5,Consecutive Net Income Growth,Average Growth\n';
                
                    var selectedZackRanks = Array.from(document.getElementsByClassName("LI-ranks")).filter(element => element.checked).map(element => element.value)
                    var selectedHeaders = Array.from(document.getElementsByClassName("LI-outputFields")).filter(element => element.checked).map(element => element.value)
                    var selectedHeaders2 = Array.from(document.getElementsByClassName("LI-outputFields2")).filter(element => element.checked).map(element => element.value)

                    // Show loading message
                    document.getElementById('loadingMessage').style.display = 'block';
                    document.getElementById('resultMessage').style.display = 'none';
                    document.getElementById('downloadLink').style.display = 'none';
                    document.getElementById('progressContainer').style.display = 'block';

                    const eventSource = new EventSource('http://144.172.75.84:3000/progress');
                    eventSource.onmessage = function(event) {
                        const progress = JSON.parse(event.data);
                        const progressText = document.getElementById('progressText');
                        progressText.innerText = `Progress: ${progress.completed}/${progress.total}`;
                    };

                    fetch('http://144.172.75.84:3000/run-program', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ inputFile, outputFile, selectedHeaders, selectedHeaders2, selectedZackRanks})
                    })
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById('loadingMessage').style.display = 'none';
                        document.getElementById('resultMessage').style.display = 'block';
                        document.getElementById('resultMessage').innerText = `${data.message}! Output file created: ` + outputFile;
                        console.log(data);

                        // Show download link
                        document.getElementById('downloadLink').style.display = 'block';
                        document.getElementById('downloadLink').href = `http://144.172.75.84:3000/download?file=${data.filePath}`;

                        eventSource.close();
                        submitButton.disabled = false;
                      })
                    .catch(error => {
                        document.getElementById('loadingMessage').style.display = 'none';
                        document.getElementById('resultMessage').style.display = 'block';
                        document.getElementById('resultMessage').innerText = 'Error: ' + error.message;
                        console.error('Error:', error);

                        eventSource.close();
                        submitButton.disabled = false;
                    });
                });

                function fetchPreviousRuns() {
                  fetch('http://144.172.75.84:3000/previous-runs')
                    .then(response => response.json())
                    .then(runs => {
                      console.log('runs', runs)
                      const previousRunsList = document.getElementById('previousRunsList');
      
                      previousRunsList.innerHTML = '';
                      const sortedRuns = runs.sort((a, b) => {
                        const dateA = new Date(a.file.match(/\d{4}-\d{2}-\d{2}/)[0]);
                        const dateB = new Date(b.file.match(/\d{4}-\d{2}-\d{2}/)[0]);
                        return dateB - dateA;
                      });
                      const lastFiveRuns = sortedRuns.slice(0, 5);
                      lastFiveRuns.forEach(run => {
                        const listItem = document.createElement('li');
                        const link = document.createElement('a');
                        link.href = `http://144.172.75.84:3000/download?file=${run.file}`;
                        link.innerText = run.file;
                        link.download = run.file;
                        listItem.appendChild(link);
   
                        if (run.duration) {
                          const durationText = document.createElement('span');
                          const minutes = Math.floor(run.duration / 60);
                          const seconds = Math.floor(run.duration % 60);
                          durationText.innerText = ` (${minutes}m:${seconds}s)`;
                          listItem.appendChild(durationText);
                        }
                        previousRunsList.appendChild(listItem);
                      });
                    })
                    .catch(error => console.error('Error fetching previous runs:', error));
                }


              function checkJobStatus() {
                  fetch('http://144.172.75.84:3000/job-status')
                      .then(response => response.json())
                      .then(data => {
                          const submitButton = document.getElementById('submitbutton');
                          if (data.isJobRunning) {
                              submitButton.disabled = true;
                          } else {
                              submitButton.disabled = false;
                          }
                      })
                      .catch(error => console.error('Error checking job status:', error));
              }
              // Fetch previous runs on page load
              document.addEventListener('DOMContentLoaded', fetchPreviousRuns);
            </script>
              <br>
              <br>
              <div id="display-value"></div>
            </form>

            <label> Prio:</label>
            <li> Finished</li>
            <label> Backlog:</label>
            <li> TODO: Show preview?</li>
            <li> TODO: Possibly add a timer that says how long it will take? HARD!?</li>
            <li> TODO: ^^^ Just use progress bar, divided total stocks by 100, 
              every time that number goes by, increase by 1% on bar</li>
            <li> TODO: Have option to select with what types (Strong Buy-Strong Sell)</li>
            <br>
          </div>
       
      </div><!-- End Provided input files -->

      <!-- ======= local input files ======= -->
      <div id="local-input-files" class="tab-pane container fade"><br>
        <h3>Menu 1</h3>
        <div class="container">   
          <label>TODO: <a href="https://www.geeksforgeeks.org/file-type-validation-while-uploading-it-using-javascript/"><span>geeksforgeeks on file validation</span></a></label>        
          <form id="LI-inputStocksForm">
            <input type="file" name="localInputFile" id="localInputFile">
            <pre id="output"></pre>
            <!-- Pick zacks rank -->
            <h4>Pick which Zack Ranks you want to output:</h4>
            <div class="d-flex flex-row">
              <div class="d-flex flex-column flex-fill inline-field">
                <label class="form-check-label">
                <input class="form-check-input LI-ranks" type="checkbox" name="StrongBuy" value="1" checked>
                Strong Buy - 1</label>
                <label class="form-check-label">
                <input class="form-check-input LI-ranks" type="checkbox" name="Buy" value="2">
                Buy - 2</label>
                <label class="form-check-label">
                <input class="form-check-input LI-ranks" type="checkbox" name="Hold" value="3">
                Hold - 3</label>
                <label class="form-check-label">
                <input class="form-check-input LI-ranks" type="checkbox" name="Sell" value="4">
                Sell - 4</label>
                <label class="form-check-label">
                <input class="form-check-input LI-ranks" type="checkbox" name="StrongSell" value="5">
                Strong Sell - 5</label>
              </div>
            </div>
            <br>

            <!-- Fields for headers -->
            <h4>Pick the fields for your output:</h4>
            <div class="d-flex flex-row">
              <!-- About check boxes-->
              <div class="d-flex flex-column flex-fill inline-field">
                <h5>About Fields</h5>
                <label class="form-check-label">
                <input class="LI-outputFields" name="Symbol" type="hidden" value="Symbol" checked>
                <input class="form-check-input" type="checkbox" name="Symbol" value="Symbol" disabled checked>
                Symbol</label>
                <label class="form-check-label">
                <input class="form-check-input LI-outputFields" type="checkbox" name="Name" value="Name" checked>
                Name</label>
                <label class="form-check-label">
                <input class="form-check-input LI-outputFields" type="checkbox" name="IndustryMajor" value="Industry Major" checked>
                Industry Major</label>
                <label class="form-check-label">
                <input class="form-check-input LI-outputFields" type="checkbox" name="IndustryMinor" value="Industry Minor" checked>
                Industry Minor</label>
              </div>

              <!-- Ranks check boxes-->
              <div class="d-flex flex-column flex-fill inline-field">
                <h5>Rank Fields</h5>
                <label class="form-check-label">
                <input class="form-check-input LI-outputFields" type="checkbox" name="ZacksRank" value="ZacksRank"checked>
                Zacks Rank</label>
                <label class="form-check-label">
                <input class="form-check-input LI-outputFields" type="checkbox" name="OverallRank" value="OverallRank"checked>
               Overall Rank</label>
                <label class="form-check-label">
                <input class="form-check-input LI-outputFields" type="checkbox" name="Value" value="Value" checked>
                Value</label>
                <label class="form-check-label">
                <input class="form-check-input LI-outputFields" type="checkbox" name="Growth" value="Growth" checked>
                Growth</label>
                <label class="form-check-label">
                <input class="form-check-input LI-outputFields" type="checkbox" name="Momentum" value="Momentum" checked>
                Momentum</label>
                <label class="form-check-label">
                <input class="form-check-input LI-outputFields" type="checkbox" name="VGM" value="VGM" checked>
                VGM</label>
              </div>

              <!-- Income check boxes-->
              <div class="d-flex flex-column flex-fill inline-field">
                <h5>Net Income Fields</h5>
                <label class="form-check-label">
                  <input class="form-check-input LI-outputFields2" type="checkbox" name="Last4Years" value="Last4Years"checked>
                  Over Last 4 Years</label>
                  <label class="form-check-label">
                  <input class="form-check-input LI-outputFields2" type="checkbox" name="Last3Years" value="Last3Years" disabled>
                  Over Last 3 Years</label>
                  <label class="form-check-label">
                  <input class="form-check-input LI-outputFields2" type="checkbox" name="Last2Years" value="Last2Years" disabled>
                  Over Last 2 Years</label>
                  <label class="form-check-label">
                  <input class="form-check-input LI-outputFields2" type="checkbox" name="ConsNetIncGrowth" value="ConsNetIncGrowth" checked>
                  Consecutive Net Income Growth</label>
                  <label class="form-check-label">
                  <input class="form-check-input LI-outputFields2" type="checkbox" name="AverageGrowth" value="AverageGrowth" checked>
                  Average Growth</label>
              </div>

            </div>
            <br>

            <!-- Submit button -->
            <button class="btn btn-info" id="localInputStocksSubmit">Submit</button>
            <br>
            <br>
            <div id="display-value"></div>
          </form>
        </div>
      </div><!-- End local input files -->

      <!-- ======= Compare 2 local input files ======= -->
      <div id="compare-2-local-files" class="tab-pane container fade"><br>
        <h3>Menu 2</h3>
        <div class="container">
          <label>TODO: Compare two files to see which stocks are now listed as Strong Buys, and which aren't.</label>
          <input type="file" name="inputfile2" id="inputfile2">
          <pre id="output2"></pre>
          <input type="file" name="inputfile3" id="inputfile3">
          <pre id="output3"></pre>
        </div>   
      </div><!-- End compare 2 local input files -->
    </div>

  </main><!-- End #main -->

  <!-- ======= Footer ======= -->
  <footer id="footer">
    <div class="container">
      <div class="copyright">
        &copy; Copyright <strong><span>iPortfolio</span></strong>
      </div>
      <div class="credits">
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you purchased the pro version. -->
        <!-- Licensing information: https://bootstrapmade.com/license/ -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/iportfolio-bootstrap-portfolio-websites-template/ -->
        Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
      </div>
    </div>
  </footer><!-- End  Footer -->

  <a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>

  <!-- Vendor JS Files -->
  <script src="assets/vendor/aos/aos.js"></script>
  <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <script src="assets/vendor/php-email-form/validate.js"></script>
  <script src="assets/vendor/purecounter/purecounter.js"></script>
  <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="assets/vendor/typed.js/typed.min.js"></script>
  <script src="assets/vendor/waypoints/noframework.waypoints.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Template Main JS File -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <!--<script src="js/cheerio/lib/index.js></script>
  <script src="js/cheerio-select/lib/index.js"></script>
  <script src="js/node-fetch/lib/index.js"></script>
  <script src="assets/js/main.js"></script>
  <script type="module" src="assets/js/functions.js"></script> -->
  <script  type="text/javascript" src="assets/js/secondary.js"></script>
</body>

</html>
